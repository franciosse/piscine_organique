{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/db/schema.ts"],"sourcesContent":["import {\n  pgTable,\n  serial,\n  varchar,\n  text,\n  timestamp,\n  integer,\n  boolean,\n} from 'drizzle-orm/pg-core';\nimport { relations } from 'drizzle-orm';\n\nexport const users = pgTable('users', {\n  id: serial('id').primaryKey(),\n  name: varchar('name', { length: 100 }),\n  email: varchar('email', { length: 255 }).notNull().unique(),\n  passwordHash: text('password_hash').notNull(),\n  role: varchar('role', { length: 20 }).notNull().default('member'),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n  deletedAt: timestamp('deleted_at'),\n  isVerified: boolean('is_verified').default(false),\n});\n\nexport const teams = pgTable('teams', {\n  id: serial('id').primaryKey(),\n  name: varchar('name', { length: 100 }).notNull(),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n  stripeCustomerId: text('stripe_customer_id').unique(),\n  stripeSubscriptionId: text('stripe_subscription_id').unique(),\n  stripeProductId: text('stripe_product_id'),\n  planName: varchar('plan_name', { length: 50 }),\n  subscriptionStatus: varchar('subscription_status', { length: 20 }),\n});\n\nexport const teamMembers = pgTable('team_members', {\n  id: serial('id').primaryKey(),\n  userId: integer('user_id')\n    .notNull()\n    .references(() => users.id),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  role: varchar('role', { length: 50 }).notNull(),\n  joinedAt: timestamp('joined_at').notNull().defaultNow(),\n});\n\nexport const activityLogs = pgTable('activity_logs', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  userId: integer('user_id').references(() => users.id),\n  action: text('action').notNull(),\n  timestamp: timestamp('timestamp').notNull().defaultNow(),\n  ipAddress: varchar('ip_address', { length: 45 }),\n});\n\nexport const invitations = pgTable('invitations', {\n  id: serial('id').primaryKey(),\n  teamId: integer('team_id')\n    .notNull()\n    .references(() => teams.id),\n  email: varchar('email', { length: 255 }).notNull(),\n  role: varchar('role', { length: 50 }).notNull(),\n  invitedBy: integer('invited_by')\n    .notNull()\n    .references(() => users.id),\n  invitedAt: timestamp('invited_at').notNull().defaultNow(),\n  status: varchar('status', { length: 20 }).notNull().default('pending'),\n});\n\n// LMS ENTITIES\n\nexport const courses = pgTable('courses', {\n  id: serial('id').primaryKey(),\n  title: varchar('title', { length: 255 }).notNull(),\n  slug: varchar('slug', { length: 255 }).notNull().unique(),\n  description: text('description'),\n  price: integer('price').notNull().default(0), // en centimes\n  published: timestamp('published_at'),\n  imageUrl: varchar('image_url', { length: 2048 }),\n  authorId: integer('author_id').references(() => users.id),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n  updatedAt: timestamp('updated_at').notNull().defaultNow(),\n});\n\nexport const lessons = pgTable('lessons', {\n  id: serial('id').primaryKey(),\n  courseId: integer('course_id')\n    .notNull()\n    .references(() => courses.id),\n  title: varchar('title', { length: 255 }).notNull(),\n  slug: varchar('slug', { length: 255 }).notNull(),\n  content: text('content'), // HTML / Markdown / RichText\n  videoUrl: varchar('video_url', { length: 2048 }),\n  order: integer('order').notNull().default(0),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const enrollments = pgTable('enrollments', {\n  id: serial('id').primaryKey(),\n  userId: integer('user_id').notNull().references(() => users.id),\n  courseId: integer('course_id').notNull().references(() => courses.id),\n  createdAt: timestamp('created_at').notNull().defaultNow(),\n});\n\nexport const progress = pgTable('progress', {\n  id: serial('id').primaryKey(),\n  userId: integer('user_id').notNull().references(() => users.id),\n  lessonId: integer('lesson_id').notNull().references(() => lessons.id),\n  completed: timestamp('completed_at'),\n});\nexport const quizzes = pgTable('quizzes', {\n  id: serial('id').primaryKey(),\n  lessonId: integer('lesson_id').references(() => lessons.id),\n  title: varchar('title', { length: 255 }).notNull(),\n});\n\nexport const questions = pgTable('questions', {\n  id: serial('id').primaryKey(),\n  quizId: integer('quiz_id').notNull().references(() => quizzes.id),\n  text: text('text').notNull(),\n});\n\nexport const answers = pgTable('answers', {\n  id: serial('id').primaryKey(),\n  questionId: integer('question_id').notNull().references(() => questions.id),\n  text: text('text').notNull(),\n  isCorrect: integer('is_correct').notNull().default(0),\n});\n\nexport const teamsRelations = relations(teams, ({ many }) => ({\n  teamMembers: many(teamMembers),\n  activityLogs: many(activityLogs),\n  invitations: many(invitations),\n}));\n\nexport const usersRelations = relations(users, ({ many }) => ({\n  teamMembers: many(teamMembers),\n  invitationsSent: many(invitations),\n}));\n\nexport const invitationsRelations = relations(invitations, ({ one }) => ({\n  team: one(teams, {\n    fields: [invitations.teamId],\n    references: [teams.id],\n  }),\n  invitedBy: one(users, {\n    fields: [invitations.invitedBy],\n    references: [users.id],\n  }),\n}));\n\nexport const teamMembersRelations = relations(teamMembers, ({ one }) => ({\n  user: one(users, {\n    fields: [teamMembers.userId],\n    references: [users.id],\n  }),\n  team: one(teams, {\n    fields: [teamMembers.teamId],\n    references: [teams.id],\n  }),\n}));\n\nexport const activityLogsRelations = relations(activityLogs, ({ one }) => ({\n  team: one(teams, {\n    fields: [activityLogs.teamId],\n    references: [teams.id],\n  }),\n  user: one(users, {\n    fields: [activityLogs.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const coursesRelations = relations(courses, ({ one, many }) => ({\n  author: one(users, {\n    fields: [courses.authorId],\n    references: [users.id],\n  }),\n  lessons: many(lessons),\n  enrollments: many(enrollments),\n}));\n\nexport const lessonsRelations = relations(lessons, ({ one, many }) => ({\n  course: one(courses, {\n    fields: [lessons.courseId],\n    references: [courses.id],\n  }),\n  progress: many(progress),\n  quizzes: many(quizzes),\n}));\n\nexport const enrollmentsRelations = relations(enrollments, ({ one }) => ({\n  user: one(users, {\n    fields: [enrollments.userId],\n    references: [users.id],\n  }),\n  course: one(courses, {\n    fields: [enrollments.courseId],\n    references: [courses.id],\n  }),\n}));\n\nexport const progressRelations = relations(progress, ({ one }) => ({\n  user: one(users, {\n    fields: [progress.userId],\n    references: [users.id],\n  }),\n  lesson: one(lessons, {\n    fields: [progress.lessonId],\n    references: [lessons.id],\n  }),\n}));\n\nexport const quizzesRelations = relations(quizzes, ({ one, many }) => ({\n  lesson: one(lessons, {\n    fields: [quizzes.lessonId],\n    references: [lessons.id],\n  }),\n  questions: many(questions),\n}));\n\nexport const questionsRelations = relations(questions, ({ one, many }) => ({\n  quiz: one(quizzes, {\n    fields: [questions.quizId],\n    references: [quizzes.id],\n  }),\n  answers: many(answers),\n}));\n\nexport const answersRelations = relations(answers, ({ one }) => ({\n  question: one(questions, {\n    fields: [answers.questionId],\n    references: [questions.id],\n  }),\n}));\n\n\nexport type User = typeof users.$inferSelect;\nexport type NewUser = typeof users.$inferInsert;\nexport type Team = typeof teams.$inferSelect;\nexport type NewTeam = typeof teams.$inferInsert;\nexport type TeamMember = typeof teamMembers.$inferSelect;\nexport type NewTeamMember = typeof teamMembers.$inferInsert;\nexport type ActivityLog = typeof activityLogs.$inferSelect;\nexport type NewActivityLog = typeof activityLogs.$inferInsert;\nexport type Invitation = typeof invitations.$inferSelect;\nexport type NewInvitation = typeof invitations.$inferInsert;\nexport type TeamDataWithMembers = Team & {\n  teamMembers: (TeamMember & {\n    user: Pick<User, 'id' | 'name' | 'email'>;\n  })[];\n};\nexport type Course = typeof courses.$inferSelect;\nexport type NewCourse = typeof courses.$inferInsert;\n\nexport type Lesson = typeof lessons.$inferSelect;\nexport type NewLesson = typeof lessons.$inferInsert;\n\nexport type Enrollment = typeof enrollments.$inferSelect;\nexport type NewEnrollment = typeof enrollments.$inferInsert;\n\n\nexport enum ActivityType {\n  SIGN_UP = 'SIGN_UP',\n  SIGN_IN = 'SIGN_IN',\n  SIGN_OUT = 'SIGN_OUT',\n  UPDATE_PASSWORD = 'UPDATE_PASSWORD',\n  DELETE_ACCOUNT = 'DELETE_ACCOUNT',\n  UPDATE_ACCOUNT = 'UPDATE_ACCOUNT',\n  CREATE_TEAM = 'CREATE_TEAM',\n  REMOVE_TEAM_MEMBER = 'REMOVE_TEAM_MEMBER',\n  INVITE_TEAM_MEMBER = 'INVITE_TEAM_MEMBER',\n  ACCEPT_INVITATION = 'ACCEPT_INVITATION',\n}\n\n\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;;;AAEO,MAAM,QAAQ,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,SAAS;IACpC,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAI;IACpC,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO,GAAG,MAAM;IACzD,cAAc,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE,iBAAiB,OAAO;IAC3C,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAG,GAAG,OAAO,GAAG,OAAO,CAAC;IACxD,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;IACvD,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;IACvD,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE;IACrB,YAAY,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,eAAe,OAAO,CAAC;AAC7C;AAEO,MAAM,QAAQ,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,SAAS;IACpC,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAI,GAAG,OAAO;IAC9C,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;IACvD,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;IACvD,kBAAkB,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE,sBAAsB,MAAM;IACnD,sBAAsB,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE,0BAA0B,MAAM;IAC3D,iBAAiB,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE;IACtB,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa;QAAE,QAAQ;IAAG;IAC5C,oBAAoB,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,uBAAuB;QAAE,QAAQ;IAAG;AAClE;AAEO,MAAM,cAAc,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,gBAAgB;IACjD,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WACb,OAAO,GACP,UAAU,CAAC,IAAM,MAAM,EAAE;IAC5B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WACb,OAAO,GACP,UAAU,CAAC,IAAM,MAAM,EAAE;IAC5B,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAG,GAAG,OAAO;IAC7C,UAAU,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,aAAa,OAAO,GAAG,UAAU;AACvD;AAEO,MAAM,eAAe,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,iBAAiB;IACnD,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WACb,OAAO,GACP,UAAU,CAAC,IAAM,MAAM,EAAE;IAC5B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WAAW,UAAU,CAAC,IAAM,MAAM,EAAE;IACpD,QAAQ,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE,UAAU,OAAO;IAC9B,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,aAAa,OAAO,GAAG,UAAU;IACtD,WAAW,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,cAAc;QAAE,QAAQ;IAAG;AAChD;AAEO,MAAM,cAAc,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,eAAe;IAChD,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WACb,OAAO,GACP,UAAU,CAAC,IAAM,MAAM,EAAE;IAC5B,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;IAChD,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAG,GAAG,OAAO;IAC7C,WAAW,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,cAChB,OAAO,GACP,UAAU,CAAC,IAAM,MAAM,EAAE;IAC5B,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;IACvD,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,UAAU;QAAE,QAAQ;IAAG,GAAG,OAAO,GAAG,OAAO,CAAC;AAC9D;AAIO,MAAM,UAAU,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,WAAW;IACxC,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;IAChD,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAI,GAAG,OAAO,GAAG,MAAM;IACvD,aAAa,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE;IAClB,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS,OAAO,GAAG,OAAO,CAAC;IAC1C,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE;IACrB,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa;QAAE,QAAQ;IAAK;IAC9C,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa,UAAU,CAAC,IAAM,MAAM,EAAE;IACxD,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;IACvD,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;AACzD;AAEO,MAAM,UAAU,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,WAAW;IACxC,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aACf,OAAO,GACP,UAAU,CAAC,IAAM,QAAQ,EAAE;IAC9B,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;IAChD,MAAM,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;QAAE,QAAQ;IAAI,GAAG,OAAO;IAC9C,SAAS,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE;IACd,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa;QAAE,QAAQ;IAAK;IAC9C,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS,OAAO,GAAG,OAAO,CAAC;IAC1C,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;AACzD;AAEO,MAAM,cAAc,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,eAAe;IAChD,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WAAW,OAAO,GAAG,UAAU,CAAC,IAAM,MAAM,EAAE;IAC9D,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa,OAAO,GAAG,UAAU,CAAC,IAAM,QAAQ,EAAE;IACpE,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE,cAAc,OAAO,GAAG,UAAU;AACzD;AAEO,MAAM,WAAW,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,YAAY;IAC1C,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WAAW,OAAO,GAAG,UAAU,CAAC,IAAM,MAAM,EAAE;IAC9D,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa,OAAO,GAAG,UAAU,CAAC,IAAM,QAAQ,EAAE;IACpE,WAAW,CAAA,GAAA,oKAAA,CAAA,YAAS,AAAD,EAAE;AACvB;AACO,MAAM,UAAU,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,WAAW;IACxC,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,UAAU,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,aAAa,UAAU,CAAC,IAAM,QAAQ,EAAE;IAC1D,OAAO,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;AAClD;AAEO,MAAM,YAAY,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,aAAa;IAC5C,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,QAAQ,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,WAAW,OAAO,GAAG,UAAU,CAAC,IAAM,QAAQ,EAAE;IAChE,MAAM,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE,QAAQ,OAAO;AAC5B;AAEO,MAAM,UAAU,CAAA,GAAA,qJAAA,CAAA,UAAO,AAAD,EAAE,WAAW;IACxC,IAAI,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,MAAM,UAAU;IAC3B,YAAY,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,eAAe,OAAO,GAAG,UAAU,CAAC,IAAM,UAAU,EAAE;IAC1E,MAAM,CAAA,GAAA,+JAAA,CAAA,OAAI,AAAD,EAAE,QAAQ,OAAO;IAC1B,WAAW,CAAA,GAAA,kKAAA,CAAA,UAAO,AAAD,EAAE,cAAc,OAAO,GAAG,OAAO,CAAC;AACrD;AAEO,MAAM,iBAAiB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,OAAO,CAAC,EAAE,IAAI,EAAE,GAAK,CAAC;QAC5D,aAAa,KAAK;QAClB,cAAc,KAAK;QACnB,aAAa,KAAK;IACpB,CAAC;AAEM,MAAM,iBAAiB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,OAAO,CAAC,EAAE,IAAI,EAAE,GAAK,CAAC;QAC5D,aAAa,KAAK;QAClB,iBAAiB,KAAK;IACxB,CAAC;AAEM,MAAM,uBAAuB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,aAAa,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACvE,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,YAAY,MAAM;aAAC;YAC5B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;QACA,WAAW,IAAI,OAAO;YACpB,QAAQ;gBAAC,YAAY,SAAS;aAAC;YAC/B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;IACF,CAAC;AAEM,MAAM,uBAAuB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,aAAa,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACvE,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,YAAY,MAAM;aAAC;YAC5B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;QACA,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,YAAY,MAAM;aAAC;YAC5B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;IACF,CAAC;AAEM,MAAM,wBAAwB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,cAAc,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACzE,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,aAAa,MAAM;aAAC;YAC7B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;QACA,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,aAAa,MAAM;aAAC;YAC7B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;IACF,CAAC;AAEM,MAAM,mBAAmB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,SAAS,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,GAAK,CAAC;QACrE,QAAQ,IAAI,OAAO;YACjB,QAAQ;gBAAC,QAAQ,QAAQ;aAAC;YAC1B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;QACA,SAAS,KAAK;QACd,aAAa,KAAK;IACpB,CAAC;AAEM,MAAM,mBAAmB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,SAAS,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,GAAK,CAAC;QACrE,QAAQ,IAAI,SAAS;YACnB,QAAQ;gBAAC,QAAQ,QAAQ;aAAC;YAC1B,YAAY;gBAAC,QAAQ,EAAE;aAAC;QAC1B;QACA,UAAU,KAAK;QACf,SAAS,KAAK;IAChB,CAAC;AAEM,MAAM,uBAAuB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,aAAa,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACvE,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,YAAY,MAAM;aAAC;YAC5B,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;QACA,QAAQ,IAAI,SAAS;YACnB,QAAQ;gBAAC,YAAY,QAAQ;aAAC;YAC9B,YAAY;gBAAC,QAAQ,EAAE;aAAC;QAC1B;IACF,CAAC;AAEM,MAAM,oBAAoB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,UAAU,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QACjE,MAAM,IAAI,OAAO;YACf,QAAQ;gBAAC,SAAS,MAAM;aAAC;YACzB,YAAY;gBAAC,MAAM,EAAE;aAAC;QACxB;QACA,QAAQ,IAAI,SAAS;YACnB,QAAQ;gBAAC,SAAS,QAAQ;aAAC;YAC3B,YAAY;gBAAC,QAAQ,EAAE;aAAC;QAC1B;IACF,CAAC;AAEM,MAAM,mBAAmB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,SAAS,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,GAAK,CAAC;QACrE,QAAQ,IAAI,SAAS;YACnB,QAAQ;gBAAC,QAAQ,QAAQ;aAAC;YAC1B,YAAY;gBAAC,QAAQ,EAAE;aAAC;QAC1B;QACA,WAAW,KAAK;IAClB,CAAC;AAEM,MAAM,qBAAqB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,WAAW,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,GAAK,CAAC;QACzE,MAAM,IAAI,SAAS;YACjB,QAAQ;gBAAC,UAAU,MAAM;aAAC;YAC1B,YAAY;gBAAC,QAAQ,EAAE;aAAC;QAC1B;QACA,SAAS,KAAK;IAChB,CAAC;AAEM,MAAM,mBAAmB,CAAA,GAAA,2IAAA,CAAA,YAAS,AAAD,EAAE,SAAS,CAAC,EAAE,GAAG,EAAE,GAAK,CAAC;QAC/D,UAAU,IAAI,WAAW;YACvB,QAAQ;gBAAC,QAAQ,UAAU;aAAC;YAC5B,YAAY;gBAAC,UAAU,EAAE;aAAC;QAC5B;IACF,CAAC;AA4BM,IAAA,AAAK,sCAAA;;;;;;;;;;;WAAA","debugId":null}},
    {"offset": {"line": 442, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/db/drizzle.ts"],"sourcesContent":["import { drizzle } from 'drizzle-orm/postgres-js';\nimport postgres from 'postgres';\nimport * as schema from './schema';\n\n// Supprime la ligne suivante :\n// import dotenv from 'dotenv';\n// dotenv.config();\n\nif (!process.env.POSTGRES_URL) {\n  throw new Error('POSTGRES_URL environment variable is not set');\n}\n\nexport const client = postgres(process.env.POSTGRES_URL);\nexport const db = drizzle(client, { schema });\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,+BAA+B;AAC/B,+BAA+B;AAC/B,mBAAmB;AAEnB,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,SAAS,CAAA,GAAA,wIAAA,CAAA,UAAQ,AAAD,EAAE,QAAQ,GAAG,CAAC,YAAY;AAChD,MAAM,KAAK,CAAA,GAAA,0JAAA,CAAA,UAAO,AAAD,EAAE,QAAQ;IAAE,QAAA;AAAO","debugId":null}},
    {"offset": {"line": 466, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/auth/session.ts"],"sourcesContent":["import { compare, hash } from 'bcryptjs';\nimport { SignJWT, jwtVerify } from 'jose';\nimport { cookies } from 'next/headers';\nimport { NewUser } from '@/lib/db/schema';\nimport { db } from '@/lib/db/drizzle';\nimport { users } from '@/lib/db/schema';\nimport { eq } from 'drizzle-orm';\n\nconst key = new TextEncoder().encode(process.env.AUTH_SECRET);\nconst SALT_ROUNDS = 10;\n\nexport async function hashPassword(password: string) {\n  return hash(password, SALT_ROUNDS);\n}\n\nexport async function comparePasswords(\n  plainTextPassword: string,\n  hashedPassword: string\n) {\n  return compare(plainTextPassword, hashedPassword);\n}\n\ntype SessionData = {\n  user: { id: number };\n  expires: string;\n};\n\nexport async function signToken(payload: SessionData) {\n  return await new SignJWT(payload)\n    .setProtectedHeader({ alg: 'HS256' })\n    .setIssuedAt()\n    .setExpirationTime('1 day from now')\n    .sign(key);\n}\n\nexport async function verifyToken(input: string) {\n  const { payload } = await jwtVerify(input, key, {\n    algorithms: ['HS256'],\n  });\n  return payload as SessionData;\n}\n\nexport async function getSession() {\n  const session = (await cookies()).get('session')?.value;\n  if (!session) return null;\n  return await verifyToken(session);\n}\n\nexport async function setSession(user: NewUser) {\n  const expiresInOneDay = new Date(Date.now() + 24 * 60 * 60 * 1000);\n  const session: SessionData = {\n    user: { id: user.id! },\n    expires: expiresInOneDay.toISOString(),\n  };\n  const encryptedSession = await signToken(session);\n  (await cookies()).set('session', encryptedSession, {\n    expires: expiresInOneDay,\n    httpOnly: true,\n    secure: true,\n    sameSite: 'lax',\n  });\n}\n\nexport async function getUser() {\n  const session = await getSession();\n  if (!session) return null;\n\n  const [user] = await db\n    .select()\n    .from(users)\n    .where(eq(users.id, session.user.id))\n    .limit(1);\n\n  return user ?? null;\n}\n"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AAAA;AACA;AAEA;AACA;AACA;;;;;;;AAEA,MAAM,MAAM,IAAI,cAAc,MAAM,CAAC,QAAQ,GAAG,CAAC,WAAW;AAC5D,MAAM,cAAc;AAEb,eAAe,aAAa,QAAgB;IACjD,OAAO,CAAA,GAAA,iIAAA,CAAA,OAAI,AAAD,EAAE,UAAU;AACxB;AAEO,eAAe,iBACpB,iBAAyB,EACzB,cAAsB;IAEtB,OAAO,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD,EAAE,mBAAmB;AACpC;AAOO,eAAe,UAAU,OAAoB;IAClD,OAAO,MAAM,IAAI,qJAAA,CAAA,UAAO,CAAC,SACtB,kBAAkB,CAAC;QAAE,KAAK;IAAQ,GAClC,WAAW,GACX,iBAAiB,CAAC,kBAClB,IAAI,CAAC;AACV;AAEO,eAAe,YAAY,KAAa;IAC7C,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAA,GAAA,uJAAA,CAAA,YAAS,AAAD,EAAE,OAAO,KAAK;QAC9C,YAAY;YAAC;SAAQ;IACvB;IACA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,CAAC,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,YAAY;IAClD,IAAI,CAAC,SAAS,OAAO;IACrB,OAAO,MAAM,YAAY;AAC3B;AAEO,eAAe,WAAW,IAAa;IAC5C,MAAM,kBAAkB,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK;IAC7D,MAAM,UAAuB;QAC3B,MAAM;YAAE,IAAI,KAAK,EAAE;QAAE;QACrB,SAAS,gBAAgB,WAAW;IACtC;IACA,MAAM,mBAAmB,MAAM,UAAU;IACzC,CAAC,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,WAAW,kBAAkB;QACjD,SAAS;QACT,UAAU;QACV,QAAQ;QACR,UAAU;IACZ;AACF;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IACtB,IAAI,CAAC,SAAS,OAAO;IAErB,MAAM,CAAC,KAAK,GAAG,MAAM,oHAAA,CAAA,KAAE,CACpB,MAAM,GACN,IAAI,CAAC,mHAAA,CAAA,QAAK,EACV,KAAK,CAAC,CAAA,GAAA,kKAAA,CAAA,KAAE,AAAD,EAAE,mHAAA,CAAA,QAAK,CAAC,EAAE,EAAE,QAAQ,IAAI,CAAC,EAAE,GAClC,KAAK,CAAC;IAET,OAAO,QAAQ;AACjB","debugId":null}},
    {"offset": {"line": 540, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/db/queries.ts"],"sourcesContent":["import { desc, and, eq, isNull } from 'drizzle-orm';\nimport { db } from './drizzle';\nimport { activityLogs, teamMembers, teams, users } from './schema';\nimport { cookies } from 'next/headers';\nimport { verifyToken } from '@/lib/auth/session';\n\nexport async function getUser() {\n  const sessionCookie = (await cookies()).get('session');\n  if (!sessionCookie || !sessionCookie.value) {\n    return null;\n  }\n\n  const sessionData = await verifyToken(sessionCookie.value);\n  if (\n    !sessionData ||\n    !sessionData.user ||\n    typeof sessionData.user.id !== 'number'\n  ) {\n    return null;\n  }\n\n  if (new Date(sessionData.expires) < new Date()) {\n    return null;\n  }\n\n  const user = await db\n    .select()\n    .from(users)\n    .where(and(eq(users.id, sessionData.user.id), isNull(users.deletedAt)))\n    .limit(1);\n\n  if (user.length === 0) {\n    return null;\n  }\n\n  return user[0];\n}\n\nexport async function getTeamByStripeCustomerId(customerId: string) {\n  const result = await db\n    .select()\n    .from(teams)\n    .where(eq(teams.stripeCustomerId, customerId))\n    .limit(1);\n\n  return result.length > 0 ? result[0] : null;\n}\n\nexport async function updateTeamSubscription(\n  teamId: number,\n  subscriptionData: {\n    stripeSubscriptionId: string | null;\n    stripeProductId: string | null;\n    planName: string | null;\n    subscriptionStatus: string;\n  }\n) {\n  await db\n    .update(teams)\n    .set({\n      ...subscriptionData,\n      updatedAt: new Date()\n    })\n    .where(eq(teams.id, teamId));\n}\n\n\nexport async function getActivityLogs() {\n  const user = await getUser();\n  if (!user) {\n    throw new Error('User not authenticated');\n  }\n\n  return await db\n    .select({\n      id: activityLogs.id,\n      action: activityLogs.action,\n      timestamp: activityLogs.timestamp,\n      ipAddress: activityLogs.ipAddress,\n      userName: users.name\n    })\n    .from(activityLogs)\n    .leftJoin(users, eq(activityLogs.userId, users.id))\n    .where(eq(activityLogs.userId, user.id))\n    .orderBy(desc(activityLogs.timestamp))\n    .limit(10);\n}\n\nexport async function getTeamForUser() {\n  const user = await getUser();\n  if (!user) {\n    return null;\n  }\n\n  const result = await db.query.teamMembers.findFirst({\n    where: eq(teamMembers.userId, user.id),\n    with: {\n      team: {\n        with: {\n          teamMembers: {\n            with: {\n              user: {\n                columns: {\n                  id: true,\n                  name: true,\n                  email: true\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  });\n\n  return result?.team || null;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 630, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/payments/stripe.ts"],"sourcesContent":["import Stripe from 'stripe';\nimport { redirect } from 'next/navigation';\nimport { Team } from '@/lib/db/schema';\nimport {\n  getTeamByStripeCustomerId,\n  getUser,\n  updateTeamSubscription\n} from '@/lib/db/queries';\n\nexport const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {\n  apiVersion: '2025-04-30.basil'\n});\n\nexport async function createCheckoutSession({\n  team,\n  priceId\n}: {\n  team: Team | null;\n  priceId: string;\n}) {\n  const user = await getUser();\n\n  if (!team || !user) {\n    redirect(`/sign-up?redirect=checkout&priceId=${priceId}`);\n  }\n\n  const session = await stripe.checkout.sessions.create({\n    payment_method_types: ['card'],\n    line_items: [\n      {\n        price: priceId,\n        quantity: 1\n      }\n    ],\n    mode: 'subscription',\n    success_url: `${process.env.BASE_URL}/api/stripe/checkout?session_id={CHECKOUT_SESSION_ID}`,\n    cancel_url: `${process.env.BASE_URL}/pricing`,\n    customer: team.stripeCustomerId || undefined,\n    client_reference_id: user.id.toString(),\n    allow_promotion_codes: true,\n    subscription_data: {\n      trial_period_days: 14\n    }\n  });\n\n  redirect(session.url!);\n}\n\nexport async function createCustomerPortalSession() {\n    redirect('/pricing');\n}\n\nexport async function handleSubscriptionChange(\n  subscription: Stripe.Subscription\n) {\n  const customerId = subscription.customer as string;\n  const subscriptionId = subscription.id;\n  const status = subscription.status;\n\n  const team = await getTeamByStripeCustomerId(customerId);\n\n  if (!team) {\n    console.error('Team not found for Stripe customer:', customerId);\n    return;\n  }\n\n  if (status === 'active' || status === 'trialing') {\n    const plan = subscription.items.data[0]?.plan;\n    await updateTeamSubscription(team.id, {\n      stripeSubscriptionId: subscriptionId,\n      stripeProductId: plan?.product as string,\n      planName: (plan?.product as Stripe.Product).name,\n      subscriptionStatus: status\n    });\n  } else if (status === 'canceled' || status === 'unpaid') {\n    await updateTeamSubscription(team.id, {\n      stripeSubscriptionId: null,\n      stripeProductId: null,\n      planName: null,\n      subscriptionStatus: status\n    });\n  }\n}\n\nexport async function getStripePrices() {\n  const prices = await stripe.prices.list({\n    expand: ['data.product'],\n    active: true,\n    type: 'recurring'\n  });\n\n  return prices.data.map((price) => ({\n    id: price.id,\n    productId:\n      typeof price.product === 'string' ? price.product : price.product.id,\n    unitAmount: price.unit_amount,\n    currency: price.currency,\n    interval: price.recurring?.interval,\n    trialPeriodDays: price.recurring?.trial_period_days\n  }));\n}\n\nexport async function getStripeProducts() {\n  const products = await stripe.products.list({\n    active: true,\n    expand: ['data.default_price']\n  });\n\n  return products.data.map((product) => ({\n    id: product.id,\n    name: product.name,\n    description: product.description,\n    defaultPriceId:\n      typeof product.default_price === 'string'\n        ? product.default_price\n        : product.default_price?.id\n  }));\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 739, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/auth/middleware.ts"],"sourcesContent":["import { z } from 'zod';\nimport { TeamDataWithMembers, User } from '@/lib/db/schema';\nimport { getTeamForUser, getUser } from '@/lib/db/queries';\nimport { redirect } from 'next/navigation';\n\nexport type ActionState = {\n  error?: string;\n  success?: string;\n  [key: string]: any; // This allows for additional properties\n};\n\ntype ValidatedActionFunction<S extends z.ZodType<any, any>, T> = (\n  data: z.infer<S>,\n  formData: FormData\n) => Promise<T>;\n\nexport function validatedAction<S extends z.ZodType<any, any>, T>(\n  schema: S,\n  action: ValidatedActionFunction<S, T>\n) {\n  return async (prevState: ActionState, formData: FormData) => {\n    const result = schema.safeParse(Object.fromEntries(formData));\n    if (!result.success) {\n      return { error: result.error.errors[0].message };\n    }\n\n    return action(result.data, formData);\n  };\n}\n\ntype ValidatedActionWithUserFunction<S extends z.ZodType<any, any>, T> = (\n  data: z.infer<S>,\n  formData: FormData,\n  user: User\n) => Promise<T>;\n\nexport function validatedActionWithUser<S extends z.ZodType<any, any>, T>(\n  schema: S,\n  action: ValidatedActionWithUserFunction<S, T>\n) {\n  return async (prevState: ActionState, formData: FormData) => {\n    const user = await getUser();\n    if (!user) {\n      throw new Error('User is not authenticated');\n    }\n\n    const result = schema.safeParse(Object.fromEntries(formData));\n    if (!result.success) {\n      return { error: result.error.errors[0].message };\n    }\n\n    return action(result.data, formData, user);\n  };\n}\n\n\n"],"names":[],"mappings":";;;;AAEA;;AAcO,SAAS,gBACd,MAAS,EACT,MAAqC;IAErC,OAAO,OAAO,WAAwB;QACpC,MAAM,SAAS,OAAO,SAAS,CAAC,OAAO,WAAW,CAAC;QACnD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO;gBAAE,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO;YAAC;QACjD;QAEA,OAAO,OAAO,OAAO,IAAI,EAAE;IAC7B;AACF;AAQO,SAAS,wBACd,MAAS,EACT,MAA6C;IAE7C,OAAO,OAAO,WAAwB;QACpC,MAAM,OAAO,MAAM,CAAA,GAAA,oHAAA,CAAA,UAAO,AAAD;QACzB,IAAI,CAAC,MAAM;YACT,MAAM,IAAI,MAAM;QAClB;QAEA,MAAM,SAAS,OAAO,SAAS,CAAC,OAAO,WAAW,CAAC;QACnD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO;gBAAE,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO;YAAC;QACjD;QAEA,OAAO,OAAO,OAAO,IAAI,EAAE,UAAU;IACvC;AACF","debugId":null}},
    {"offset": {"line": 775, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/lib/payments/actions.ts"],"sourcesContent":["'use server';\n\nimport { redirect } from 'next/navigation';\nimport { createCheckoutSession, createCustomerPortalSession } from './stripe';\nimport { withTeam } from '@/lib/auth/middleware';\n\nexport const checkoutAction = withTeam(async (formData, team) => {\n  const priceId = formData.get('priceId') as string;\n  await createCheckoutSession({ team: team, priceId });\n});\n\nexport const customerPortalAction = withTeam(async (_, team) => {\n  const portalSession = await createCustomerPortalSession(team);\n  redirect(portalSession.url);\n});\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;;;;;;AAEO,MAAM,iBAAiB,CAAA,GAAA,yHAAA,CAAA,WAAQ,AAAD,EAAE,OAAO,UAAU;IACtD,MAAM,UAAU,SAAS,GAAG,CAAC;IAC7B,MAAM,CAAA,GAAA,yHAAA,CAAA,wBAAqB,AAAD,EAAE;QAAE,MAAM;QAAM;IAAQ;AACpD;AAEO,MAAM,uBAAuB,CAAA,GAAA,yHAAA,CAAA,WAAQ,AAAD,EAAE,OAAO,GAAG;IACrD,MAAM,gBAAgB,MAAM,CAAA,GAAA,yHAAA,CAAA,8BAA2B,AAAD,EAAE;IACxD,CAAA,GAAA,qLAAA,CAAA,WAAQ,AAAD,EAAE,cAAc,GAAG;AAC5B;;;IARa;IAKA;;AALA,+OAAA;AAKA,+OAAA","debugId":null}},
    {"offset": {"line": 811, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/.next-internal/server/app/%5Blocale%5D/%28dashboard%29/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {customerPortalAction as '7f3bd58267d6ed99465ea02ed12d7ad7213946b116'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA","debugId":null}},
    {"offset": {"line": 863, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/app/%5Blocale%5D/%28dashboard%29/dashboard/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/[locale]/(dashboard)/dashboard/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/[locale]/(dashboard)/dashboard/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+S,GAC5U,6EACA","debugId":null}},
    {"offset": {"line": 875, "column": 0}, "map": {"version":3,"sources":["file:///media/franciosse/Data/Repos/piscine_organique/app/%5Blocale%5D/%28dashboard%29/dashboard/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/[locale]/(dashboard)/dashboard/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/[locale]/(dashboard)/dashboard/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA2R,GACxT,yDACA","debugId":null}},
    {"offset": {"line": 887, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}